# git merge 和 git rebase 
## git rebase 
git rebase 是 Git 版本控制系统中一个非常强大的命令，它用于将一系列的提交（commits）重新应用到另一个基点上。这个命令在整理项目历史、将特性分支（feature branch）合并到主分支（如 master 或 main）之前清理其历史等方面非常有用。与 git merge 不同，git rebase 并不是通过创建一个新的合并提交（merge commit）来合并两个分支的历史，而是通过创建一个新的提交序列，这个序列是将分支上的变更“重新播放”到另一个分支的顶部得到的。

### 基本用法
假设你有两个分支：master 和 feature，你想要将 feature 分支上的变更合并到 master 分支，但你想以 master 分支的最新状态为基准来应用这些变更。

首先，确保你处于 feature 分支上：
```
git checkout feature
```
将 feature 分支的变更重新基于 master 分支的最新状态进行应用：
```
git rebase master
```
这个命令会尝试将 feature 分支上从与 master 分支分叉点开始的所有变更，重新应用到 master 分支的最新提交之上。如果 master 分支在你开始 rebase 操作之后又有新的提交，Git 会尝试智能地解决任何冲突（如果有的话）。

### 注意事项
* 不要对已经推送到远程仓库的分支使用 rebase：如果你已经将一个分支推送到远程仓库，并且其他协作者可能也从这个分支拉取了代码，那么你应该避免对这个分支进行 rebase。因为 rebase 会改变提交的历史，这会导致远程仓库和你的本地仓库之间产生冲突。如果你确实需要这么做，你应该先与团队成员协调。
* 解决冲突：如果在 rebase 过程中出现冲突，Git 会停止 rebase 操作，并让你解决冲突。解决完冲突后，你需要使用 git add 命令来标记冲突已经解决，然后使用 git rebase --continue 来继续 rebase 操作。
* 撤销 rebase：如果你在 rebase 过程中遇到问题并希望撤销，可以使用 git rebase --abort 命令。
### 优点
* 使得项目历史更加清晰和线性，因为所有的变更都是连续地应用到主分支上的。
* 减少了不必要的合并提交，使得查看提交历史更加容易。
### 缺点
* 可能会改变公共分支的提交历史，导致与其他协作者的冲突。
* 解决冲突可能更加复杂，因为 rebase 试图将一系列变更连续地应用到另一个分支上，而不是像合并那样简单地合并两个分支的历史。



## git rebase 和 git merge 区别

`git rebase` 和 `git merge` 都是 Git 版本控制系统中用于合并分支的命令，但它们在工作方式和结果上存在一些显著的区别。

### 一、合并历史记录的方式

- **git merge**：会将两个分支的更改合并为一个新的提交（称为合并提交或merge commit），这个新提交有两个父提交，分别指向合并之前的两个分支的最新提交。这种合并方式保留了每个分支的提交历史记录，并明确显示了哪些分支在何时合并，有助于保持分支历史的清晰可见。

  <img src="../images/02.svg" alt="将master合并到功能分支中" style="zoom:33%;" />

- **git rebase**：会将当前分支的提交“移动”到目标分支的最新提交之后，并逐个重新应用这些提交。这使得提交历史变得更加线性，因为所有提交都看起来像是在目标分支上连续进行的。然而，这种合并方式会改变原始分支的提交历史，将它们的提交移动到新的基点上。
  <img src="../images/03.svg" alt="将功能分支重新映射到主服务器上" style="zoom: 33%;" />

### 二、修改历史记录的能力

- **git merge**：不会修改原始分支的提交历史。它会保留每个分支的提交历史记录，并通过创建一个新的合并提交来整合这些历史。
- **git rebase**：会修改当前分支的提交历史。在将当前分支的提交重新应用到目标分支的顶部时，Git 会创建一个新的提交序列，这些提交与原始提交在内容上相同，但在提交历史中的位置不同。

### 三、处理冲突的方式

- **git merge**：在合并过程中，如果存在冲突，Git 会自动创建一个合并提交，其中包含两个分支的所有更改。解决冲突后，提交这个合并提交即可。这意味着冲突解决是在整个分支的合并结果上进行的。
- **git rebase**：在 rebase 过程中，Git 会逐个将当前分支的提交应用到目标分支上。如果在某个提交上发生冲突，Git 会停止 rebase 操作，并提示解决冲突。解决冲突后，需要继续 rebase 操作，以便将剩余的提交应用到目标分支上。这意味着冲突解决是在每个提交上进行的，而不是在整个分支上。

### 四、使用场景

- **git merge**：适用于需要保留每个分支完整历史记录的场景，特别是在多人协作的项目中，保留分支历史有助于团队成员理解项目的变更过程。此外，当两个分支的历史相对独立，且希望明确显示它们之间的合并关系时，也适合使用 git merge。
- **git rebase**：适用于希望保持提交历史线性和清晰的场景。在特性分支或临时性修复分支上工作时，使用 git rebase 可以避免产生不必要的合并提交，使得项目历史更加整洁。然而，需要注意的是，git rebase 会改变提交历史，因此在使用时需要谨慎，避免在公共分支上使用导致冲突。

## git rebase 应用场景

### 场景

> 在使用 Git TBD 的模式管理分支，并且以main分支作为主干分支
>
> 现在我以 main 分支作为基础分出切出一个 dev 分支进行功能开发，开发完成后，我需要将 dev 分支上的提交记录 rebase 到 main分支中

在使用 Git 进行版本控制时，当你从主分支（如 `main`）切出一个开发分支（如 `dev`）进行功能开发，并在开发完成后希望将这些改动以更清晰的方式合并回主分支时，使用 `rebase` 是一个很好的选择。`rebase` 会将 `dev` 分支上的更改重新“基于” `main` 分支的最新状态应用，这样可以保持项目历史的线性，让提交历史更加清晰。

以下是具体的操作步骤：

### 1. 确保你处于 `dev` 分支

首先，确保你当前位于 `dev` 分支上。你可以通过以下命令查看当前分支，并切换到 `dev` 分支（如果不在该分支上）：

```bash
git status  # 查看当前分支  
git checkout dev  # 切换到 dev 分支
```

### 2. 确保 `main` 分支是最新的

在将 `dev` 分支的更改 rebase 到 `main` 之前，你应该确保 `main` 分支是最新的。这通常意味着你需要从远程仓库拉取最新的更改。

```bash
git checkout main  # 切换到 main 分支  
git pull origin main  # 从远程仓库拉取 main 分支的最新更改  
git checkout dev  # 切换回 dev 分支
```

### 3. 使用 `rebase` 将 `dev` 分支的更改应用到 `main` 上

现在，你可以使用 `rebase` 命令将 `dev` 分支的更改重新基于 `main` 分支的最新状态。这将“重放” `dev` 分支上的每个提交，但是每个提交都会被放置到 `main` 分支的顶端。

```bash
bash复制代码

git rebase main
```

### 4. 解决可能出现的冲突

在 rebase 过程中，可能会遇到冲突。如果发生冲突，Git 会暂停 rebase 过程，并让你解决这些冲突。你需要手动编辑冲突的文件，然后执行以下命令来标记冲突已解决：

```bash
git add <conflicted-file>  # 添加已解决冲突的文件  
git rebase --continue  # 继续 rebase 过程
```

如果解决冲突后你想放弃 rebase，可以使用 `git rebase --abort`。

### 5. 推送 `dev` 分支到远程仓库（如果需要）

如果你的团队成员正在使用相同的远程仓库，并且你也希望他们看到你的 rebase 更改，你需要将更新后的 `dev` 分支推送到远程仓库。注意，由于你已经改变了 `dev` 分支的历史，所以在推送时可能需要使用 `--force`（或 `--force-with-lease`，更安全）选项来覆盖远程分支上的历史。

```bash
bash复制代码

git push origin dev --force-with-lease
```

### 6. 将 `dev` 分支的更改合并到 `main`（可选）

如果你的团队决定 `dev` 分支上的更改已准备好合并到 `main`，你现在可以使用一个快速的合并（因为 `dev` 已经基于 `main` rebase 过，所以不会产生复杂的合并提交）：

```bash
git checkout main  
git merge dev  
git push origin main
```

这就是将 `dev` 分支的更改 rebase 到 `main` 分支上的整个过程。



## 参考资料

[git rebase VS git merge？ 更优雅的 git 合并方式值得拥有 - 日拱一兵 - 博客园 (cnblogs.com)](https://www.cnblogs.com/FraserYu/p/11192840.html)